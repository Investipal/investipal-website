---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Breadcrumb from '../components/ui/Breadcrumb.astro';
import StandardButton from '../components/ui/StandardButton.astro';
import StandardBadge from '../components/ui/StandardBadge.astro';
import StandardIcon from '../components/ui/StandardIcon.astro';
import CookieBanner from '../components/ui/CookieBanner.astro';
import { designSystem } from '../data/designSystem';
import PageHeroSection from '../components/sections/PageHeroSection.astro';
import CTASection from '../components/sections/CTASection.astro';

// SEO and Meta data
const title = "Webinars | Educational Content for Financial Advisors | Investipal";
const description = "Watch educational webinars for financial advisors. Learn about AI automation, portfolio management, compliance, and industry best practices from Investipal experts.";
const canonical = "https://investipal.co/webinars";
const keywords = "financial advisor webinars, wealth management education, AI automation training, portfolio management webinars, compliance education";

const breadcrumbItems = [
  { name: 'Home', href: '/' },
  { name: 'Webinars', href: '/webinars' }
];

// Featured Webinar Data (based on the Webflow data)
const featuredWebinar = {
  id: "get-started-with-short-form-video-as-a-financial-advisor",
  title: "Get Started with Short-Form Video as a Financial Advisor",
  shortInfo: "Learn how to grow your financial advisory business with short-form video content.",
  slug: "get-started-with-short-form-video-as-a-financial-advisor",
  badge: "ðŸŸ  Recorded Webinar",
  overview: "Learn the secrets of short-form video from the most successful CFPÂ® professionals on social media, Nick Meyer, CFPÂ® and Nate Hoskin, CFPÂ®, AWMA of N2 Content Marketing (2 million+ followers, 450 million+ views) + how to screen, convert and onboard the leads you get from social media with Investipal.",
  partnerLogo: {
    url: "https://uploads-ssl.webflow.com/666872ff37bdf42ce9637d77/667ddb5b73545c116835a1d6_N2_Logo__1_-removebg-preview.png",
    alt: "N2 Content Marketing"
  },
  keyPoints: [
    "Why you NEED to embrace Short-Form Video. The numbers don't lie: financial advisors who don't leverage short-form video content will fall behind.",
    "Exactly how to get started with Short-Form Video including an overview of the different platforms, profile setup best practices, what equipment you'll need, and more.",
    "How to use Investipal's automations to increase conversions and free up time to create more content. Learn how Investipal makes it easy to qualify, convert and onboard the leads you'll receive from social media, shortening sales processes from the typical 1-3 weeks to 1 day."
  ],
  speakers: [
    {
      name: "Cameron Howe",
      title: "CEO",
      company: "Investipal",
      image: "https://uploads-ssl.webflow.com/666872ff37bdf42ce9637d77/667dd66ddce16374e49c9a55_Untitled%20design%20(1).png"
    },
    {
      name: "Nick Meyer, CFPÂ®",
      title: "Co-Founder",
      company: "N2 Content Marketing",
      image: "https://uploads-ssl.webflow.com/666872ff37bdf42ce9637d77/667dd67575c9831d7a0d2967_unnamed.png"
    },
    {
      name: "Nate Hoskin, CFPÂ®, AWMA",
      title: "Co-Founder", 
      company: "N2 Content Marketing",
      image: "https://uploads-ssl.webflow.com/666872ff37bdf42ce9637d77/667ddddc092943e63a91a638_unnamed%20(1).png"
    }
  ],
  youtubeEmbedLink: "https://www.youtube.com/embed/CqlNgbpjB_Y?si=FLTa_hul8fPzp1og"
};

// Additional webinar topics (sample data)
// No upcoming webinars currently
const upcomingWebinars: Array<{
  date: string;
  title: string;
  description: string;
  speakers: string[];
  registrationUrl: string;
}> = [];

// Structured Data
const structuredData = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": title,
  "description": description,
  "url": canonical,
  "mainEntity": {
    "@type": "EducationalEvent",
    "name": featuredWebinar.title,
    "description": featuredWebinar.shortInfo,
    "eventAttendanceMode": "https://schema.org/OnlineEventAttendanceMode",
    "eventStatus": "https://schema.org/EventScheduled",
    "organizer": {
      "@type": "Organization",
      "name": "Investipal",
      "url": "https://investipal.co"
    }
  },
  "breadcrumb": {
    "@type": "BreadcrumbList", 
    "itemListElement": breadcrumbItems.map((item, index) => ({
      "@type": "ListItem",
      "position": index + 1,
      "name": item.name,
      ...(item.href && { "item": new URL(item.href, 'https://investipal.co').toString() })
    }))
  }
};
---

<Layout title={title} description={description} canonical={canonical} keywords={keywords} preloadImages={["https://img.youtube.com/vi/CqlNgbpjB_Y/maxresdefault.jpg"]}>
  <!-- Structured Data -->
  <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
  
  <Header />
  <Breadcrumb items={breadcrumbItems} />

  <main id="main">
    <!-- Standardized Hero (design system) -->
    <PageHeroSection
      title="Educational Webinars for Financial Advisors"
      subtitle="Join industry experts and learn how to leverage AI and automation to grow your advisory practice, improve client outcomes, and stay ahead of the competition."
      ctaText="Subscribe to Webinars"
      ctaHref="#newsletter"
    />

    <!-- Featured Webinar -->
    <section class="py-20 md:py-24 lg:py-28 bg-gray-50">
      <div class={designSystem.spacing.container}>
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
          <div class="p-8 md:p-12 lg:p-16">
            
            <!-- Badge and Partner Logo -->
            <div class="flex items-center justify-between mb-8">
              <StandardBadge text={featuredWebinar.badge} variant="secondary" />
              {featuredWebinar.partnerLogo && (
                <div class="flex items-center space-x-3">
                  <span class="text-sm text-gray-600">Presented by</span>
                  <img 
                    src="https://c.animaapp.com/medefhqzj4Kk73/assets/6668e3b171e3a42c69ea29a0_investipal_logo_master_Primary-no_margin.svg" 
                    alt="Investipal" 
                    class="h-6"
                  />
                  <img 
                    src={featuredWebinar.partnerLogo.url} 
                    alt={featuredWebinar.partnerLogo.alt}
                    class="h-8"
                  />
                </div>
              )}
            </div>

            <!-- Title and Overview -->
            <h2 class={`${designSystem.typography.sectionTitle} mb-6`}>
              {featuredWebinar.title}
            </h2>
            
            <p class={`${designSystem.typography.bodyLarge} mb-8`}>
              {featuredWebinar.overview}
            </p>

            <!-- Video Poster (click to play in modal) -->
            {(() => {
              const src = String(featuredWebinar.youtubeEmbedLink || '');
              const after = src.split('/embed/')[1] || '';
              const youtubeId = after.split('?')[0] || '';
              const thumb = youtubeId ? `https://img.youtube.com/vi/${youtubeId}/maxresdefault.jpg` : '';
              return (
                <div class="mb-12">
                  <button type="button" class="group relative w-full aspect-video rounded-xl overflow-hidden shadow-lg focus:outline-none" data-open-webinar>
                    <img src={thumb} alt={featuredWebinar.title} class="w-full h-full object-cover" loading="lazy" />
                    <div class="absolute inset-0 bg-black/20 group-hover:bg-black/30 transition-colors"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                      <span class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-white/90 group-hover:bg-white shadow-md transition">
                        <svg class="w-8 h-8 text-investipal-700" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                      </span>
                    </div>
                  </button>
                </div>
              );
            })()}

            <!-- Key Points -->
            <div class="grid lg:grid-cols-2 gap-12 lg:gap-16 mb-16">
              <div>
                <h3 class={`${designSystem.typography.subsectionTitle} mb-8`}>
                  This webinar will cover:
                </h3>
                <div class="space-y-6">
                  {featuredWebinar.keyPoints.map((point) => (
                    <div class="flex items-start space-x-4">
                      <div class={designSystem.components.iconContainer}>
                        <svg class="w-5 h-5 text-investipal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                      </div>
                      <p class={designSystem.typography.body}>
                        {point}
                      </p>
                    </div>
                  ))}
                </div>
              </div>

              <!-- Speakers -->
              <div>
                <h3 class={`${designSystem.typography.subsectionTitle} mb-8`}>
                  Speakers
                </h3>
                <div class="space-y-8">
                  {featuredWebinar.speakers.map((speaker) => (
                    <div class="flex items-center space-x-6">
                      <img 
                        src={speaker.image} 
                        alt={speaker.name}
                        class="w-20 h-20 rounded-full object-cover shadow-lg"
                      />
                      <div>
                        <h4 class={`${designSystem.typography.componentTitle} mb-2`}>
                          {speaker.name}
                        </h4>
                        <p class={`${designSystem.typography.bodySmall} text-gray-600 mb-1`}>
                          {speaker.title}
                        </p>
                        <p class={`${designSystem.typography.bodySmall} text-investipal-600 font-medium`}>
                          {speaker.company}
                        </p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Upcoming Webinars (hidden if none available) -->
    {upcomingWebinars && upcomingWebinars.length > 0 && (
    <section class="py-20 md:py-24 lg:py-28 bg-white">
      <div class={designSystem.spacing.container}>
        <div class="text-center mb-16">
          <h2 class={`${designSystem.typography.sectionTitle} mb-6`}>
            Upcoming Webinars
          </h2>
          <p class={`${designSystem.typography.bodyLarge} max-w-2xl mx-auto`}>
            Stay tuned for more educational content designed to help financial advisors succeed in the modern landscape.
          </p>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          {upcomingWebinars.map((webinar) => (
            <div class="bg-gray-50 rounded-xl p-6 hover:shadow-lg transition-shadow">
              <div class="flex items-center justify-between mb-4">
                <StandardBadge text={webinar.date} variant="outline" />
                <StandardIcon 
                  icon={`<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>`}
                  size="medium"
                />
              </div>
              
              <h3 class={`${designSystem.typography.componentTitle} mb-3`}>
                {webinar.title}
              </h3>
              
              <p class={`${designSystem.typography.body} mb-4`}>
                {webinar.description}
              </p>
              
              <div class="flex items-center justify-between">
                <div class="text-sm text-gray-600">
                  By {webinar.speakers.join(", ")}
                </div>
                <StandardButton href={webinar.registrationUrl} variant="outline" size="small">
                  Notify Me
                </StandardButton>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
    )}

    <!-- Newsletter Signup -->
    <section id="newsletter" class={`${designSystem.spacing.section} ${designSystem.background.secondary}`}>
      <div class={designSystem.spacing.container}>
        <div class="max-w-3xl mx-auto text-center">
          <h2 class={`${designSystem.typography.sectionTitle} mb-4`}>
            Never Miss a Webinar
          </h2>
          <p class={`${designSystem.typography.bodyLarge} mb-8`}>
            Subscribe to get notified about upcoming webinars, educational content, and industry insights.
          </p>
          
          <form class="flex flex-col sm:flex-row gap-4 max-w-lg mx-auto" method="POST" data-form="newsletter">
            <input
              type="email"
              name="email"
              placeholder="Enter your email address"
              required
              class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-investipal-500 focus:border-investipal-500"
            />
            <StandardButton type="submit">
              Subscribe
            </StandardButton>
          </form>
        </div>
      </div>
    </section>

    <!-- CTA Section (Design System) -->
    <CTASection />
  </main>

  <Footer />
  <CookieBanner />
</Layout>

<script>
  // Newsletter form handling and webinar modal
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('[data-form="newsletter"]');
    const openBtn = document.querySelector('[data-open-webinar]');

    if (form) {
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        const formEl = form as HTMLFormElement;
        const formData = new FormData(formEl);
        const email = formData.get('email');
        try {
          await new Promise(resolve => setTimeout(resolve, 1000));
          const button = form.querySelector('button[type="submit"]');
          const originalText = button?.textContent ?? 'Subscribe';
          if (button) {
            (button as HTMLButtonElement).textContent = 'Subscribed!';
            button.classList.add('bg-green-600', 'hover:bg-green-700');
            setTimeout(() => {
              (button as HTMLButtonElement).textContent = originalText;
              button.classList.remove('bg-green-600', 'hover:bg-green-700');
              formEl.reset();
            }, 2000);
          }
        } catch (error) {
          console.error('Newsletter subscription error:', error);
        }
      });
    }

    function ensureModal() {
      let modal = document.getElementById('webinar-modal');
      if (modal) return modal;
      modal = document.createElement('div');
      modal.id = 'webinar-modal';
      modal.className = 'fixed inset-0 z-50 hidden';
      modal.innerHTML = `
        <div class="absolute inset-0 bg-black/60"></div>
        <div class="relative max-w-5xl mx-auto mt-20 bg-white rounded-xl shadow-2xl overflow-hidden">
          <div class="aspect-video">
            <iframe id="webinar-iframe" class="w-full h-full" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          </div>
          <button type="button" class="absolute top-3 right-3 p-2 rounded-full bg-white shadow" data-close-webinar aria-label="Close">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
          </button>
        </div>`;
      document.body.appendChild(modal);
      return modal;
    }

    function openModal() {
      const modal = ensureModal();
      const iframe = modal.querySelector<HTMLIFrameElement>('#webinar-iframe');
      if (iframe) {
        iframe.src = '${featuredWebinar.youtubeEmbedLink}'.replace('autoplay=0','autoplay=1');
      }
      modal.classList.remove('hidden');
      modal.addEventListener('click', (e) => {
        if (e.target === modal || (e.target as Element).closest('[data-close-webinar]')) {
          if (iframe) iframe.src = '';
          modal.classList.add('hidden');
        }
      }, { once: true });
    }

    openBtn?.addEventListener('click', openModal);
  });
</script>
