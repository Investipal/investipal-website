---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Breadcrumb from '../components/ui/Breadcrumb.astro';
import CookieBanner from '../components/ui/CookieBanner.astro';
import CTASection from '../components/sections/CTASection.astro';
import TableOfContents from '../components/blog/TableOfContents.astro';
import { designSystem } from '../data/designSystem';

// SEO Metadata
const title = "Cookie Policy - Investipal";
const description = "Learn about how Investipal uses cookies to enhance your experience and analyze our traffic. Manage your cookie preferences and understand your choices.";
const canonical = "https://investipal.co/cookies";

// Page Data
const pageData = {
  title: "Cookie Policy",
  lastUpdated: "December 2024",
  content: {
    intro: "This Cookie Policy explains how Investipal Inc. (\"Investipal,\" \"we,\" \"us,\" or \"our\") uses cookies and similar technologies when you visit our website at investipal.co (the \"Website\"). It explains what these technologies are and why we use them, as well as your rights to control our use of them.",
    
    sections: [
      {
        title: "What Are Cookies?",
        content: `Cookies are small data files that are placed on your computer or mobile device when you visit a website. Cookies are widely used by website owners in order to make their websites work, or to work more efficiently, as well as to provide reporting information.
        
Cookies set by the website owner (in this case, Investipal) are called "first party cookies". Cookies set by parties other than the website owner are called "third party cookies". Third party cookies enable third party features or functionality to be provided on or through the website (e.g. like advertising, interactive content and analytics). The parties that set these third party cookies can recognize your computer both when it visits the website in question and also when it visits certain other websites.`
      },
      {
        title: "Why Do We Use Cookies?",
        content: `We use first and third party cookies for several reasons. Some cookies are required for technical reasons in order for our Website to operate, and we refer to these as "essential" or "strictly necessary" cookies. Other cookies also enable us to track and target the interests of our users to enhance the experience on our Website. Third parties serve cookies through our Website for advertising, analytics and other purposes.`
      },
      {
        title: "Types of Cookies We Use",
        subsections: [
          {
            title: "Essential Cookies",
            description: "These cookies are strictly necessary to provide you with services available through our Website and to use some of its features, such as access to secure areas.",
            examples: [
              "Session management cookies",
              "Security cookies to prevent fraudulent use",
              "Load balancing cookies"
            ]
          },
          {
            title: "Performance and Analytics Cookies",
            description: "These cookies allow us to count visits and traffic sources so we can measure and improve the performance of our Website. They help us to know which pages are the most and least popular and see how visitors move around the Website.",
            examples: [
              "Google Analytics cookies",
              "Website performance monitoring",
              "User behavior tracking"
            ]
          },
          {
            title: "Functionality Cookies",
            description: "These cookies enable the Website to provide enhanced functionality and personalization. They may be set by us or by third party providers whose services we have added to our pages.",
            examples: [
              "User preference cookies",
              "Language selection cookies",
              "Feature customization cookies"
            ]
          },
          {
            title: "Targeting and Advertising Cookies",
            description: "These cookies may be set through our Website by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant adverts on other sites.",
            examples: [
              "Advertising network cookies",
              "Social media platform cookies",
              "Retargeting cookies"
            ]
          }
        ]
      },
      {
        title: "Cookie Consent and Your Choices",
        content: `When you first visit our Website, you will see a cookie banner that allows you to accept or decline non-essential cookies. You have the following choices regarding cookies:

**Accept All Cookies:** By clicking "Accept" on our cookie banner, you consent to our use of all cookies as described in this policy.

**Decline Non-Essential Cookies:** By clicking "Decline" on our cookie banner, you choose to allow only essential cookies that are necessary for the Website to function properly.

**Browser Settings:** Most web browsers allow you to control cookies through their settings preferences. However, if you disable cookies, you may find that certain sections or features of our Website will not work properly.`
      },
      {
        title: "Managing Cookie Preferences",
        content: `You can manage your cookie preferences at any time by:

1. **Using our Cookie Banner:** When you first visit our site, you can accept or decline cookies using the banner that appears.

2. **Browser Settings:** You can set your browser to refuse all or some browser cookies, or to alert you when websites set or access cookies. If you disable or refuse cookies, please note that some parts of our Website may become inaccessible or not function properly.

3. **Third-Party Opt-Out:** For third-party cookies, you can opt out directly with the third-party provider or through industry opt-out tools:
   - Google Analytics: https://tools.google.com/dlpage/gaoptout
   - Network Advertising Initiative: http://www.networkadvertising.org/choices/
   - Digital Advertising Alliance: http://www.aboutads.info/choices/`
      },
      {
        title: "Cookie Duration",
        content: `Cookies may be either "session cookies" or "persistent cookies":

**Session Cookies:** These cookies expire when you close your browser session and are not retained on your device afterwards.

**Persistent Cookies:** These cookies remain on your device until they expire or you delete them. The duration depends on the specific cookie, but typically ranges from a few days to several years.

We regularly review and update the cookies we use to ensure they are necessary and provide value to our users.`
      },
      {
        title: "Updates to This Cookie Policy",
        content: `We may update this Cookie Policy from time to time in order to reflect, for example, changes to the cookies we use or for other operational, legal or regulatory reasons. Please therefore re-visit this Cookie Policy regularly to stay informed about our use of cookies and related technologies.

The date at the top of this Cookie Policy indicates when it was last updated.`
      },
      {
        title: "Contact Us",
        content: `If you have any questions about our use of cookies or other technologies, please contact us at:

**Email:** info@investipal.co
**Address:** Investipal Inc., [Company Address]

For more information about our privacy practices, please review our Privacy Policy.`
      }
    ]
  }
};

// Generate table of contents headings for the standardized component
const headings = [
  { depth: 2, slug: "what-are-cookies", text: "What Are Cookies?" },
  { depth: 2, slug: "why-use-cookies", text: "Why Do We Use Cookies?" },
  { depth: 2, slug: "types-of-cookies", text: "Types of Cookies We Use" },
  { depth: 3, slug: "essential-cookies", text: "Essential Cookies" },
  { depth: 3, slug: "performance-cookies", text: "Performance and Analytics Cookies" },
  { depth: 3, slug: "functionality-cookies", text: "Functionality Cookies" },
  { depth: 3, slug: "advertising-cookies", text: "Targeting and Advertising Cookies" },
  { depth: 2, slug: "cookie-consent", text: "Cookie Consent and Your Choices" },
  { depth: 2, slug: "managing-preferences", text: "Managing Cookie Preferences" },
  { depth: 2, slug: "cookie-duration", text: "Cookie Duration" },
  { depth: 2, slug: "policy-updates", text: "Updates to This Cookie Policy" },
  { depth: 2, slug: "contact-us", text: "Contact Us" }
];

// Generate structured data for the Cookie Policy page
const siteUrl = Astro.site?.toString() || 'https://investipal.co';
const currentUrl = new URL(Astro.url.pathname, siteUrl).toString();

const cookiePolicyStructuredData = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Cookie Policy",
  "description": description,
  "url": currentUrl,
  "inLanguage": "en-US",
  "isPartOf": {
    "@type": "WebSite",
    "name": "Investipal",
    "url": siteUrl
  },
  "about": {
    "@type": "Thing",
    "name": "Cookie Policy",
    "description": "Information about how cookies are used on the Investipal website"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Investipal",
    "url": siteUrl
  }
};

// Generate breadcrumb items
const breadcrumbItems = [
  { name: 'Home', href: '/' },
  { name: 'Cookie Policy' }
];
---

<Layout title={title} description={description} canonical={canonical}>
  <!-- Cookie Policy Structured Data -->
  <script type="application/ld+json" set:html={JSON.stringify(cookiePolicyStructuredData)} />

  <Header />
  <Breadcrumb items={breadcrumbItems} />

  <main id="main">

    <!-- Hero Section -->
    <section class="bg-white py-20">
      <div class={designSystem.spacing.container}>
        <div class="text-center">
          <h1 class={designSystem.typography.pageTitle}>
            {pageData.title}
          </h1>
          <p class={`${designSystem.typography.bodyLarge} mt-6 ${designSystem.text.secondary}`}>
            {pageData.content.intro}
          </p>
        </div>
      </div>
    </section>

    <!-- Cookie Policy Content -->
    <section class="bg-white py-20">
      <div class={designSystem.spacing.container}>
        <article class="prose prose-lg max-w-none">
          
          <div class="mb-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
            <p class={`text-sm ${designSystem.text.secondary} mb-2`}>
              <strong>Last Updated:</strong> {pageData.lastUpdated}
            </p>
            <p class={`text-sm ${designSystem.text.secondary}`}>
              <strong>Contact:</strong> For questions about this cookie policy, contact us at 
              <a href="mailto:info@investipal.co" class={designSystem.links.primary}>info@investipal.co</a>
            </p>
          </div>

          <!-- Quick Cookie Control -->
          <div class="mb-12 p-6 bg-gradient-to-r from-investipal-50 to-blue-50 rounded-lg border border-investipal-200">
            <h2 class={`${designSystem.typography.componentTitle} mb-4`}>Manage Your Cookie Preferences</h2>
            <p class={`${designSystem.text.secondary} mb-4`}>
              You can control how we use cookies on our website. Your current preference will be remembered for future visits.
            </p>
            <div class="flex flex-wrap gap-3">
              <button 
                id="accept-all-cookies"
                class="px-4 py-2 bg-investipal-600 text-white rounded-lg hover:bg-investipal-700 transition-colors font-medium"
              >
                Accept All Cookies
              </button>
              <button 
                id="decline-optional-cookies"
                class="px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors font-medium"
              >
                Essential Cookies Only
              </button>
              <button 
                id="reset-cookie-preferences"
                class="px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors font-medium"
              >
                Reset Preferences
              </button>
            </div>
          </div>

          <!-- Policy Content -->
          {pageData.content.sections.map((section, index) => (
            <section id={headings[index + 1]?.slug || `section-${index}`} class="mb-12">
              <h2 class={`${designSystem.typography.subsectionTitle} mb-6`}>{section.title}</h2>
              
              {section.content && (
                <div class="prose prose-lg max-w-none mb-6">
                  {section.content.split('\n\n').map((paragraph) => (
                    <p class={`${designSystem.typography.body} mb-4`} set:html={paragraph.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')} />
                  ))}
                </div>
              )}

              {section.subsections && (
                <div class="space-y-8">
                  {section.subsections.map((subsection) => (
                    <div>
                      <h3 class={`${designSystem.typography.featureTitle} mb-4`}>{subsection.title}</h3>
                      <p class={`${designSystem.text.secondary} mb-4`}>{subsection.description}</p>
                      {subsection.examples && (
                        <ul class={`list-disc list-inside space-y-2 ${designSystem.text.tertiary}`}>
                          {subsection.examples.map((example) => (
                            <li>{example}</li>
                          ))}
                        </ul>
                      )}
                    </div>
                  ))}
                </div>
              )}
            </section>
          ))}

        </article>
      </div>
    </section>

    <!-- CTA Section -->
    <CTASection />

  </main>

  <!-- Standardized Table of Contents -->
  <TableOfContents headings={headings} readingTime={10} />

  <Footer />
  <CookieBanner />
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const acceptAllBtn = document.getElementById('accept-all-cookies');
    const declineOptionalBtn = document.getElementById('decline-optional-cookies');
    const resetPrefsBtn = document.getElementById('reset-cookie-preferences');
    const cookieBanner = document.getElementById('cookie-banner');
    
    // Accept all cookies
    acceptAllBtn?.addEventListener('click', function() {
      localStorage.setItem('cookie-choice', 'accepted');
      cookieBanner?.classList.add('hidden');
      showNotification('All cookies accepted. Your preferences have been saved.');
      
      if (typeof (window as any).handleCookieAccept === 'function') {
        (window as any).handleCookieAccept();
      }
    });
    
    // Decline optional cookies
    declineOptionalBtn?.addEventListener('click', function() {
      localStorage.setItem('cookie-choice', 'declined');
      cookieBanner?.classList.add('hidden');
      showNotification('Only essential cookies will be used. Your preferences have been saved.');
      
      if (typeof (window as any).handleCookieDecline === 'function') {
        (window as any).handleCookieDecline();
      }
    });
    
    // Reset preferences
    resetPrefsBtn?.addEventListener('click', function() {
      localStorage.removeItem('cookie-choice');
      cookieBanner?.classList.remove('hidden');
      showNotification('Cookie preferences reset. Please make a new selection.');
    });
    
    // Show notification
    function showNotification(message: string) {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg shadow-lg z-[1001]';
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 4000);
    }
  });
</script>

<style>
  /* Ensure the cookie banner is visible when preferences are reset */
  #cookie-banner:not(.hidden) {
    display: block !important;
  }
  
  /* Style for policy content links */
  .prose a {
    color: #0284c7;
    text-decoration: none;
  }
  
  .prose a:hover {
    color: #0369a1;
    text-decoration: underline;
  }
</style>
